<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><title data-next-head="">System Design: Building a URL Shortener That Handles Billions of Requests<!-- --> | CodeSprintPro</title><meta name="description" content="A complete system design walkthrough for a URL shortener ‚Äî from requirements and storage estimates through hashing strategy, caching architecture, and global deployment patterns." data-next-head=""/><meta name="author" content="Sachin Sarawgi" data-next-head=""/><link rel="canonical" href="https://codesprintpro.com/blog/system-design-url-shortener/" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="og:title" content="System Design: Building a URL Shortener That Handles Billions of Requests" data-next-head=""/><meta property="og:description" content="A complete system design walkthrough for a URL shortener ‚Äî from requirements and storage estimates through hashing strategy, caching architecture, and global deployment patterns." data-next-head=""/><meta property="og:url" content="https://codesprintpro.com/blog/system-design-url-shortener/" data-next-head=""/><meta property="og:image" content="https://codesprintpro.com/images/og-default.jpg" data-next-head=""/><meta property="og:site_name" content="CodeSprintPro" data-next-head=""/><meta property="article:published_time" content="2025-01-29" data-next-head=""/><meta property="article:author" content="Sachin Sarawgi" data-next-head=""/><meta property="article:section" content="System Design" data-next-head=""/><meta property="article:tag" content="system design" data-next-head=""/><meta property="article:tag" content="distributed systems" data-next-head=""/><meta property="article:tag" content="databases" data-next-head=""/><meta property="article:tag" content="caching" data-next-head=""/><meta property="article:tag" content="aws" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:title" content="System Design: Building a URL Shortener That Handles Billions of Requests" data-next-head=""/><meta name="twitter:description" content="A complete system design walkthrough for a URL shortener ‚Äî from requirements and storage estimates through hashing strategy, caching architecture, and global deployment patterns." data-next-head=""/><meta name="twitter:image" content="https://codesprintpro.com/images/og-default.jpg" data-next-head=""/><script type="application/ld+json" data-next-head="">{"@context":"https://schema.org","@type":"BlogPosting","headline":"System Design: Building a URL Shortener That Handles Billions of Requests","description":"A complete system design walkthrough for a URL shortener ‚Äî from requirements and storage estimates through hashing strategy, caching architecture, and global deployment patterns.","image":"https://codesprintpro.com/images/og-default.jpg","datePublished":"2025-01-29","dateModified":"2025-01-29","author":{"@type":"Person","name":"Sachin Sarawgi","url":"https://codesprintpro.com","sameAs":["https://www.linkedin.com/in/sachin-sarawgi/","https://github.com/codesprintpro","https://medium.com/@codesprintpro"]},"publisher":{"@type":"Organization","name":"CodeSprintPro","url":"https://codesprintpro.com","logo":{"@type":"ImageObject","url":"https://codesprintpro.com/favicon/favicon-96x96.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://codesprintpro.com/blog/system-design-url-shortener/"},"keywords":"system design, distributed systems, databases, caching, aws","articleSection":"System Design"}</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerPolicy="no-referrer"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/735d4373f93910ca.css" as="style"/><link rel="stylesheet" href="/_next/static/css/735d4373f93910ca.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-11a4a2dad04962bb.js" defer=""></script><script src="/_next/static/chunks/framework-1ce91eb6f9ecda85.js" defer=""></script><script src="/_next/static/chunks/main-c7f4109f032d7b6e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1a852bd9e38c70ab.js" defer=""></script><script src="/_next/static/chunks/730-db7827467817f501.js" defer=""></script><script src="/_next/static/chunks/90-1cd4611704c3dbe0.js" defer=""></script><script src="/_next/static/chunks/440-29f4b99a44e744b5.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-0c1b14a33d5e05ee.js" defer=""></script><script src="/_next/static/rpFn_jslWZ9qPkJwor7RD/_buildManifest.js" defer=""></script><script src="/_next/static/rpFn_jslWZ9qPkJwor7RD/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__className_f367f3"><div class="min-h-screen bg-white"><nav class="fixed w-full z-50 transition-all duration-300 bg-white shadow-md" style="transform:translateY(-100px) translateZ(0)"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><a class="text-xl font-bold transition-colors text-blue-600" href="/">CodeSprintPro</a><div class="hidden md:flex items-center space-x-8"><a class="text-sm font-medium transition-colors text-blue-600" href="/blog/">Blog</a><a class="text-sm font-medium transition-colors text-gray-600 hover:text-blue-600" href="/#about">About</a><a class="text-sm font-medium transition-colors text-gray-600 hover:text-blue-600" href="/#portfolio">Portfolio</a><a class="text-sm font-medium transition-colors text-gray-600 hover:text-blue-600" href="/#contact">Contact</a></div><button class="md:hidden p-2 rounded-lg transition-colors hover:bg-gray-100 text-gray-600" aria-label="Toggle mobile menu"><svg class="w-6 h-6" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div></div></nav><div class="pt-20"><div class="bg-gradient-to-br from-gray-900 to-blue-950 py-16"><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-5xl"><nav class="flex items-center gap-2 text-sm text-gray-400 mb-6"><a class="hover:text-white transition-colors" href="/">Home</a><span>/</span><a class="hover:text-white transition-colors" href="/blog/">Blog</a><span>/</span><span class="text-gray-300 truncate max-w-xs">System Design: Building a URL Shortener That Handles Billions of Requests</span></nav><span class="inline-block text-xs font-semibold px-3 py-1 rounded-full bg-blue-100 text-blue-700 mb-4">System Design</span><h1 class="text-3xl md:text-5xl font-bold text-white mb-4 leading-tight">System Design: Building a URL Shortener That Handles Billions of Requests</h1><p class="text-gray-300 text-lg mb-6 max-w-3xl">A complete system design walkthrough for a URL shortener ‚Äî from requirements and storage estimates through hashing strategy, caching architecture, and global deployment patterns.</p><div class="flex flex-wrap items-center gap-4 text-gray-400 text-sm"><span class="flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>Sachin Sarawgi</span><span>¬∑</span><span>January 29, 2025</span><span>¬∑</span><span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>12 min read</span></div><div class="flex flex-wrap gap-2 mt-4"><span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">#<!-- -->system design</span><span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">#<!-- -->distributed systems</span><span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">#<!-- -->databases</span><span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">#<!-- -->caching</span><span class="text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded">#<!-- -->aws</span></div></div></div><div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-5xl py-12"><div class="flex gap-12"><div class="flex-1 min-w-0"><article class="prose prose-lg max-w-none prose-headings:text-gray-900 prose-headings:font-bold prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4 prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3 prose-p:text-gray-700 prose-p:leading-relaxed prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-blockquote:border-blue-600 prose-blockquote:text-gray-600 prose-code:text-blue-700 prose-code:bg-blue-50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:before:content-none prose-code:after:content-none prose-pre:rounded-xl prose-img:rounded-xl prose-img:shadow-md prose-table:text-sm prose-th:bg-gray-100 prose-th:text-gray-700"><p>The URL shortener is the "Hello World" of system design interviews ‚Äî but most candidates treat it superficially. The interesting parts are not in generating a short code; they're in the numbers that reveal the true scale, the caching strategy that makes redirects feel instant, and the analytics pipeline that handles billions of click events without slowing down the redirect path.</p>
<p>Let's build bit.ly.</p>
<h2>Requirements</h2>
<p><strong>Functional:</strong></p>
<ul>
<li>Create a short URL from a long URL (with optional custom alias)</li>
<li>Redirect short URL to the original long URL</li>
<li>Set optional expiry on URLs</li>
<li>Track click analytics (count, geo, referrer, device)</li>
</ul>
<p><strong>Non-Functional:</strong></p>
<ul>
<li>100M new URLs created per day</li>
<li>10:1 read-to-write ratio (1B redirects/day)</li>
<li>Redirect latency p99 &#x3C; 50ms globally</li>
<li>High availability (99.99% uptime ‚Äî ~52 minutes downtime/year)</li>
<li>URL data retained for 5 years</li>
</ul>
<h2>Back-of-Envelope Calculations</h2>
<p>Before writing any code, you need to understand the numbers. This calculation reveals the most important architectural constraint: the system is overwhelmingly read-heavy, which means caching is not an optimization ‚Äî it's the core design requirement.</p>
<pre><code>Write throughput:
  100M URLs/day √∑ 86,400 sec/day = ~1,160 writes/sec
  Peak (10x): ~12,000 writes/sec

Read throughput:
  1B redirects/day = ~11,600 reads/sec
  Peak: ~115,000 reads/sec

Storage (5 years):
  100M URLs/day √ó 365 days √ó 5 years = 182.5B URLs
  Per URL record: 500 bytes (URL + metadata + indexes)
  Total: 182.5B √ó 500 = ~91 TB

Cache:
  Pareto principle: 20% of URLs generate 80% of traffic
  Hot URLs to cache: 20% of daily URLs = 20M
  Cache storage: 20M √ó 500 bytes = ~10 GB (fits on a single Redis node)

Short code namespace:
  Using Base62 (a-z, A-Z, 0-9) with 7 characters:
  62^7 = 3.5 trillion unique codes (covers 182.5B URLs with room to spare)
</code></pre>
<p>Notice the asymmetry: reads outpace writes 100:1 at peak. This single insight drives nearly every architectural decision you'll make ‚Äî from separate read and write APIs to the three-tier caching strategy described later.</p>
<h2>API Design</h2>
<p>Your API surface should be minimal and purpose-driven. The three core endpoints map directly to the three user actions: create a short link, follow it, and measure its impact. Notice that the redirect uses a <code>302</code> status code rather than <code>301</code> ‚Äî a deliberate choice explained in the redirect implementation section.</p>
<pre><code>POST /api/v1/urls
Body: { "longUrl": "https://...", "customAlias": "my-link", "expiresAt": "2026-01-01" }
Response: { "shortUrl": "https://codesprt.pro/ab3Xk2p", "shortCode": "ab3Xk2p" }

GET /{shortCode}
Response: 302 Redirect to long URL
Headers: Location: https://original-url.com

DELETE /api/v1/urls/{shortCode}
Auth: Bearer token (only URL owner can delete)

GET /api/v1/urls/{shortCode}/analytics
Response: { "totalClicks": 15420, "uniqueVisitors": 8930, "clicksByDay": [...] }
</code></pre>
<h2>Database Schema</h2>
<p>Your database schema needs to serve two very different workloads: the URL lookup (read path) and click analytics (write-heavy, time-series). Keeping them in the same table ‚Äî or even the same database ‚Äî would let the analytics writes compete with redirect reads. The schema below separates these concerns explicitly.</p>
<pre><code class="language-sql">-- URLs table (primary storage)
CREATE TABLE urls (
    id            BIGINT PRIMARY KEY,          -- Auto-increment or Snowflake ID
    short_code    VARCHAR(10) UNIQUE NOT NULL, -- "ab3Xk2p"
    long_url      TEXT NOT NULL,               -- Original URL (up to 2048 chars)
    user_id       BIGINT,                      -- NULL for anonymous
    created_at    TIMESTAMP NOT NULL DEFAULT NOW(),
    expires_at    TIMESTAMP,                   -- NULL = never expires
    is_active     BOOLEAN NOT NULL DEFAULT TRUE,
    click_count   BIGINT NOT NULL DEFAULT 0    -- Approximate counter (for display)
);

CREATE INDEX idx_urls_short_code ON urls(short_code); -- Primary lookup index
CREATE INDEX idx_urls_user_id ON urls(user_id);       -- User's URL history
CREATE INDEX idx_urls_expires_at ON urls(expires_at) WHERE expires_at IS NOT NULL;

-- Click events (analytics) ‚Äî separate table, separate DB
-- Consider: ClickHouse or Cassandra for write-heavy analytics
CREATE TABLE click_events (
    id            UUID DEFAULT gen_random_uuid(),
    short_code    VARCHAR(10) NOT NULL,
    clicked_at    TIMESTAMP NOT NULL,
    ip_hash       VARCHAR(64),                -- Hashed for privacy
    country       VARCHAR(2),
    city          VARCHAR(100),
    device_type   VARCHAR(20),               -- mobile, desktop, tablet, bot
    browser       VARCHAR(50),
    referer       TEXT
) PARTITION BY RANGE (clicked_at);           -- Monthly partitions
</code></pre>
<p>The partial index on <code>expires_at WHERE expires_at IS NOT NULL</code> is a subtle but important optimization: it only indexes rows that actually have an expiry, keeping the index small and fast for the cleanup job that runs nightly.</p>
<h2>Short Code Generation: Why Base62 Over MD5</h2>
<p>With the schema established, the next question is how to generate the short code itself. This is where most candidates go straight to "just MD5 the URL," but that approach has fundamental problems at scale. Here's a comparison of the real options and why each matters.</p>
<p><strong>Option A: MD5 hash of URL</strong> ‚Äî Take first 7 characters of MD5(long_url)</p>
<ul>
<li>Problem: Two identical long URLs produce the same short code</li>
<li>Problem: Collision probability grows with scale (birthday problem)</li>
<li>Problem: Must check database for collision on every create ‚Äî expensive</li>
</ul>
<p><strong>Option B: Auto-increment ID encoded in Base62</strong> ‚Äî Generate an auto-increment ID, encode to Base62</p>
<ul>
<li>ID 1 ‚Üí "1", ID 10,000 ‚Üí "2bI", ID 3,500,000,000 ‚Üí "DTRK4"</li>
<li>Collision-free by design ‚Äî each ID is unique</li>
<li>No database read-before-write needed</li>
<li>Predictable (slightly guessable) ‚Äî acceptable for public short links</li>
</ul>
<p><strong>Option C: Snowflake ID</strong> ‚Äî 64-bit unique ID with timestamp + worker ID + sequence</p>
<ul>
<li>Globally unique across distributed systems without coordination</li>
<li>Not guessable (includes worker ID and microseconds)</li>
<li>Encodes to 7-8 Base62 characters</li>
</ul>
<p><strong>Recommended: Option B for simplicity, Option C for security.</strong></p>
<p>The following implementation shows how a Base62 encoder works. Think of it like converting a decimal number to a different base ‚Äî the same way you convert binary to hexadecimal ‚Äî except here your "digits" are 62 characters from a-z, A-Z, and 0-9.</p>
<pre><code class="language-java">public class Base62Encoder {

    private static final String ALPHABET = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

    public static String encode(long id) {
        if (id == 0) return String.valueOf(ALPHABET.charAt(0));
        StringBuilder sb = new StringBuilder();
        while (id > 0) {
            sb.append(ALPHABET.charAt((int)(id % 62)));
            id /= 62;
        }
        return sb.reverse().toString();
    }

    public static long decode(String code) {
        long id = 0;
        for (char c : code.toCharArray()) {
            id = id * 62 + ALPHABET.indexOf(c);
        }
        return id;
    }
}

// Usage
long nextId = idGenerator.nextId(); // Redis INCR or DB sequence
String shortCode = Base62Encoder.encode(nextId); // "ab3Xk2p"
</code></pre>
<p>Notice that <code>decode</code> is the inverse operation: it lets you reconstruct the original database row ID from any short code, which is useful for debugging and for analytics joins.</p>
<h2>System Architecture</h2>
<p>With your data model and encoding strategy in place, here is how all the components fit together. The key insight is that reads and writes are handled by entirely separate API services ‚Äî this lets you scale them independently and protects the high-throughput read path from any slowness in the write path.</p>
<pre><code>                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ      CloudFront CDN       ‚îÇ
                        ‚îÇ  (caches 301 redirects)   ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ    Application Load       ‚îÇ
                        ‚îÇ    Balancer (ALB)         ‚îÇ
                        ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò
                           ‚îÇ                  ‚îÇ
               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ  Write API   ‚îÇ          ‚îÇ   Read API       ‚îÇ
               ‚îÇ  (URL create)‚îÇ          ‚îÇ   (redirects)    ‚îÇ
               ‚îÇ  ~1.2K rps   ‚îÇ          ‚îÇ   ~115K rps      ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ                       ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   PostgreSQL   ‚îÇ     ‚îÇ     Redis Cluster        ‚îÇ
         ‚îÇ   Primary      ‚îÇ     ‚îÇ   (URL cache, ~10GB)     ‚îÇ
         ‚îÇ   (writes)     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   Cache-hit rate: >95%   ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ                         ‚îÇ cache miss
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  PG Read        ‚îÇ      ‚îÇ   PostgreSQL Read     ‚îÇ
         ‚îÇ  Replicas (2x)  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   Replicas           ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                           ‚îÇ
                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                              ‚îÇ   Analytics Pipeline       ‚îÇ
                              ‚îÇ  Kafka ‚Üí ClickHouse        ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<p>Notice how the analytics pipeline sits entirely off the critical read path. Click events are written asynchronously to Kafka, which means a slow analytics write can never delay a redirect response.</p>
<h2>The Critical Path: Redirect in Under 50ms</h2>
<p>The redirect is the most latency-sensitive operation in the system. Think of it like a highway toll booth: you need the transaction to complete in under a second, or traffic backs up. The implementation below achieves this by checking Redis first (1-2ms), falling back to the database only on a miss, and dispatching analytics entirely asynchronously so it never adds to your response time.</p>
<pre><code class="language-java">@RestController
public class RedirectController {

    @Autowired
    private RedisTemplate&#x3C;String, String> redis;

    @Autowired
    private UrlRepository urlRepository;

    @Autowired
    private KafkaTemplate&#x3C;String, ClickEvent> kafkaTemplate;

    @GetMapping("/{shortCode}")
    public ResponseEntity&#x3C;Void> redirect(
            @PathVariable String shortCode,
            HttpServletRequest request) {

        String cacheKey = "url:" + shortCode;

        // Step 1: Redis lookup (~1-2ms)
        String longUrl = redis.opsForValue().get(cacheKey);

        if (longUrl == null) {
            // Step 2: Database lookup (cache miss, ~5-10ms)
            Url url = urlRepository.findByShortCode(shortCode)
                .filter(u -> u.isActive())
                .filter(u -> u.getExpiresAt() == null || u.getExpiresAt().isAfter(Instant.now()))
                .orElseThrow(() -> new UrlNotFoundException(shortCode));

            longUrl = url.getLongUrl();

            // Populate cache (24h TTL, refresh on access)
            redis.opsForValue().set(cacheKey, longUrl, Duration.ofHours(24));
        }

        // Step 3: Async analytics (never in critical path)
        String finalUrl = longUrl;
        CompletableFuture.runAsync(() ->
            kafkaTemplate.send("click-events", ClickEvent.builder()
                .shortCode(shortCode)
                .timestamp(Instant.now())
                .ipHash(hashIp(request.getRemoteAddr()))
                .userAgent(request.getHeader("User-Agent"))
                .referer(request.getHeader("Referer"))
                .build())
        );

        // Step 4: Redirect (302 = don't cache, 301 = browser caches)
        return ResponseEntity.status(HttpStatus.FOUND)
            .header(HttpHeaders.LOCATION, finalUrl)
            .build();
    }
}
</code></pre>
<p>The <code>302</code> vs <code>301</code> choice is worth understanding deeply: a <code>301</code> tells browsers to cache the redirect permanently, reducing server load but making it impossible to update or expire the URL without clearing browser caches across all users. A <code>302</code> ensures every redirect hits your servers, which is why <code>301</code> is only appropriate for truly permanent, immutable links.</p>
<p><strong>Total redirect time breakdown:</strong></p>
<ul>
<li>Redis hit: ~2ms</li>
<li>Redis miss + DB read: ~12ms</li>
<li>Response serialization: ~1ms</li>
<li>Network: depends on region</li>
</ul>
<h2>Caching Strategy</h2>
<p>Now that you understand the critical path, the caching strategy becomes clear: you want to intercept requests as close to the user as possible, at each of three layers. Think of this like a library's book retrieval system ‚Äî you first check if the book is on your desk (Redis), then the local shelf (read replica), and only then send a request to the central archive (primary database).</p>
<pre><code>Three-tier caching for redirects:

Tier 1: CDN (CloudFront)
  - Cache 301 redirects at edge nodes (50+ global PoPs)
  - TTL: match URL expiry, or 24h for non-expiring URLs
  - Reduces latency to &#x3C;10ms globally for hot URLs
  - Invalidate via CloudFront API on URL deletion

Tier 2: Redis Cluster
  - 10GB cluster covers top 20M URLs (80% of traffic)
  - Eviction: allkeys-lfu (keeps frequently-accessed URLs)
  - TTL: 24 hours, refreshed on access
  - Replication: 1 primary + 2 replicas per shard

Tier 3: PostgreSQL Read Replicas
  - 2 replicas with connection pooling (PgBouncer)
  - Only for cache misses (&#x3C;5% of traffic)
  - Handles ~5,000 queries/sec comfortably
</code></pre>
<p>The choice of <code>allkeys-lfu</code> (Least Frequently Used) eviction in Redis is deliberate: it keeps the URLs that receive the most ongoing traffic, rather than the most recently added ones (<code>allkeys-lru</code>). This ensures viral links stay in cache even if they were created weeks ago.</p>
<h2>Analytics: ClickHouse for Sub-Second Queries on Billions of Rows</h2>
<p>PostgreSQL cannot efficiently aggregate billions of click events. ClickHouse, a column-oriented OLAP database, handles this natively. The distinction matters because PostgreSQL stores data row-by-row (great for fetching complete records), while ClickHouse stores data column-by-column (great for aggregating one column across billions of rows). When you run <code>COUNT(*)</code> on a 90-day click log, ClickHouse only reads the <code>clicked_at</code> column ‚Äî not the entire row ‚Äî which is why it stays fast at scale.</p>
<pre><code class="language-sql">-- ClickHouse schema
CREATE TABLE click_events (
    short_code    LowCardinality(String),   -- dictionary-encoded for efficiency
    clicked_at    DateTime,
    country       LowCardinality(String),
    device_type   LowCardinality(String),
    browser       LowCardinality(String),
    ip_hash       FixedString(32)
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(clicked_at)
ORDER BY (short_code, clicked_at);

-- Analytics query: 30-day click trend ‚Äî runs in &#x3C;1 second on billions of rows
SELECT
    toDate(clicked_at) AS date,
    count() AS total_clicks,
    uniqExact(ip_hash) AS unique_visitors,
    countIf(device_type = 'mobile') AS mobile_clicks
FROM click_events
WHERE short_code = 'ab3Xk2p'
  AND clicked_at >= now() - INTERVAL 30 DAY
GROUP BY date
ORDER BY date;
</code></pre>
<p>The <code>LowCardinality(String)</code> type is a ClickHouse optimization worth noting: for columns with a small number of distinct values (like <code>device_type</code> or <code>country</code>), ClickHouse applies dictionary encoding automatically, reducing storage by up to 10x and accelerating GROUP BY operations significantly.</p>
<h2>Edge Cases That Matter in Interviews</h2>
<p>With the happy path designed, you need to handle the failure modes. These edge cases are not hypothetical ‚Äî each represents a real abuse vector or operational issue that production URL shorteners encounter daily.</p>
<p><strong>1. Custom alias collision:</strong></p>
<p>When a user requests a custom alias, you must check for uniqueness before committing, because unlike auto-generated codes, custom aliases can conflict with existing entries.</p>
<pre><code class="language-java">if (customAlias != null) {
    if (urlRepository.existsByShortCode(customAlias)) {
        throw new AliasAlreadyTakenException(customAlias);
    }
    shortCode = customAlias;
}
</code></pre>
<p><strong>2. URL validation:</strong></p>
<p>Without validation, your shortener becomes a free proxy for phishing and malware distribution. Checking that the target URL is not your own domain prevents redirect loops, while the safety check guards against abuse.</p>
<pre><code class="language-java">// Prevent redirect loops and abuse
private void validateUrl(String longUrl) {
    if (longUrl.contains("codesprt.pro")) {
        throw new InvalidUrlException("Cannot shorten our own URLs");
    }
    // Check against malware/phishing blocklist
    if (safetyCheckService.isMalicious(longUrl)) {
        throw new MaliciousUrlException();
    }
}
</code></pre>
<p><strong>3. Expired URL cleanup:</strong></p>
<p>Expired URLs should never be hard-deleted, because the analytics records still reference them. A nightly soft-delete sets <code>is_active = false</code> so the redirect path rejects the code while the analytics data remains intact.</p>
<pre><code class="language-java">@Scheduled(cron = "0 0 2 * * *") // 2 AM daily
public void deactivateExpiredUrls() {
    urlRepository.deactivateExpired(Instant.now()); // Soft delete
    // Don't hard delete ‚Äî analytics need the record
}
</code></pre>
<p><strong>4. Rate limiting URL creation:</strong></p>
<pre><code class="language-java">// 100 URLs/day for free tier, 10,000/day for pro
// Redis sliding window: see rate limiter article
</code></pre>
<p>The URL shortener is a microcosm of distributed systems challenges: write idempotency, cache invalidation, async event processing, and global latency targets. Nail these, and you've demonstrated the architectural thinking that matters.</p>
</article><div class="my-10 rounded-xl border border-yellow-200 bg-yellow-50 p-6"><div class="flex items-center gap-2 mb-1"><span class="text-lg">üìö</span><h3 class="text-base font-bold text-gray-900">Recommended Resources</h3></div><div class="space-y-4"><div class="flex items-start gap-3 bg-white rounded-lg p-4 border border-yellow-100"><div class="flex-1 min-w-0"><div class="flex items-center gap-2 flex-wrap mb-1"><span class="font-semibold text-gray-900 text-sm">System Design Interview ‚Äî Alex Xu</span><span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-medium">Best Seller</span></div><p class="text-xs text-gray-600">Step-by-step guide to ace system design interviews with real-world examples.</p></div><a href="https://amzn.to/3TqsPRp" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 text-xs bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium whitespace-nowrap">View on Amazon<!-- --> ‚Üí</a></div><div class="flex items-start gap-3 bg-white rounded-lg p-4 border border-yellow-100"><div class="flex-1 min-w-0"><div class="flex items-center gap-2 flex-wrap mb-1"><span class="font-semibold text-gray-900 text-sm">Grokking System Design on Educative</span></div><p class="text-xs text-gray-600">Interactive course teaching system design with visual diagrams and practice problems.</p></div><a href="https://www.educative.io/courses/grokking-the-system-design-interview" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 text-xs bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium whitespace-nowrap">View Course<!-- --> ‚Üí</a></div><div class="flex items-start gap-3 bg-white rounded-lg p-4 border border-yellow-100"><div class="flex-1 min-w-0"><div class="flex items-center gap-2 flex-wrap mb-1"><span class="font-semibold text-gray-900 text-sm">Designing Data-Intensive Applications</span></div><p class="text-xs text-gray-600">Martin Kleppmann&#x27;s book is essential reading for any system design role.</p></div><a href="https://amzn.to/3RyKzOA" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 text-xs bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium whitespace-nowrap">View on Amazon<!-- --> ‚Üí</a></div></div></div><div class="mt-10 pt-8 border-t border-gray-100"><p class="text-sm text-gray-500 mb-3">Found this useful? Share it:</p><div class="flex gap-3"><a href="https://twitter.com/intent/tweet?text=System%20Design%3A%20Building%20a%20URL%20Shortener%20That%20Handles%20Billions%20of%20Requests&amp;url=https%3A%2F%2Fcodesprintpro.com%2Fblog%2Fsystem-design-url-shortener%2F" target="_blank" rel="noopener noreferrer" class="text-xs bg-gray-900 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">Share on X/Twitter</a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcodesprintpro.com%2Fblog%2Fsystem-design-url-shortener%2F" target="_blank" rel="noopener noreferrer" class="text-xs bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Share on LinkedIn</a></div></div></div><aside class="hidden lg:block w-64 flex-shrink-0"><nav class="hidden lg:block sticky top-24"><h4 class="text-xs font-semibold uppercase tracking-widest text-gray-400 mb-3">On This Page</h4><ul class="space-y-1"><li class=""><a href="#requirements" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Requirements</a></li><li class=""><a href="#back-of-envelope-calculations" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Back-of-Envelope Calculations</a></li><li class=""><a href="#api-design" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">API Design</a></li><li class=""><a href="#database-schema" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Database Schema</a></li><li class=""><a href="#short-code-generation-why-base62-over-md5" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Short Code Generation: Why Base62 Over MD5</a></li><li class=""><a href="#system-architecture" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">System Architecture</a></li><li class=""><a href="#the-critical-path-redirect-in-under-50ms" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">The Critical Path: Redirect in Under 50ms</a></li><li class=""><a href="#caching-strategy" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Caching Strategy</a></li><li class=""><a href="#analytics-clickhouse-for-sub-second-queries-on-billions-of-rows" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Analytics: ClickHouse for Sub-Second Queries on Billions of Rows</a></li><li class=""><a href="#edge-cases-that-matter-in-interviews" class="block text-sm py-1 border-l-2 pl-3 transition-all border-transparent text-gray-500 hover:text-gray-900 hover:border-gray-300 ">Edge Cases That Matter in Interviews</a></li></ul></nav></aside></div><div class="mt-16 pt-10 border-t border-gray-100"><h2 class="text-2xl font-bold text-gray-900 mb-6">Related Articles</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><a href="/blog/observability-opentelemetry-production/"><article class="group bg-white rounded-xl border border-gray-200 p-6 h-full cursor-pointer hover:border-blue-300 hover:shadow-lg transition-all"><span class="inline-block text-xs font-semibold px-3 py-1 rounded-full mb-3 bg-blue-100 text-blue-700">System Design</span><h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors leading-snug">Building Production Observability with OpenTelemetry and Grafana Stack</h3><p class="text-gray-600 text-sm mb-4 line-clamp-3">Observability is not the same as monitoring. Monitoring tells you something is wrong. Observability lets you understand why ‚Äî by exploring system state through metrics, traces, and logs without needing to know in advance‚Ä¶</p><div class="flex items-center justify-between text-xs text-gray-400"><span>Jul 3, 2025</span><span class="flex items-center gap-1"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>6 min read</span></div><div class="mt-3 flex flex-wrap gap-1"><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->observability</span><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->opentelemetry</span><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->prometheus</span></div></article></a><a href="/blog/event-sourcing-cqrs-production/"><article class="group bg-white rounded-xl border border-gray-200 p-6 h-full cursor-pointer hover:border-blue-300 hover:shadow-lg transition-all"><span class="inline-block text-xs font-semibold px-3 py-1 rounded-full mb-3 bg-blue-100 text-blue-700">System Design</span><h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors leading-snug">Event Sourcing and CQRS in Production: Beyond the Theory</h3><p class="text-gray-600 text-sm mb-4 line-clamp-3">Event sourcing is one of those patterns that looks elegant in conference talks and becomes surprisingly complex in production systems. The theory ‚Äî store events instead of state, derive state by replaying events ‚Äî is sou‚Ä¶</p><div class="flex items-center justify-between text-xs text-gray-400"><span>Jun 23, 2025</span><span class="flex items-center gap-1"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>7 min read</span></div><div class="mt-3 flex flex-wrap gap-1"><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->event sourcing</span><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->cqrs</span><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->system design</span></div></article></a><a href="/blog/grpc-vs-rest-vs-graphql/"><article class="group bg-white rounded-xl border border-gray-200 p-6 h-full cursor-pointer hover:border-blue-300 hover:shadow-lg transition-all"><span class="inline-block text-xs font-semibold px-3 py-1 rounded-full mb-3 bg-blue-100 text-blue-700">System Design</span><h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors leading-snug">gRPC vs REST vs GraphQL: Choosing the Right API Protocol</h3><p class="text-gray-600 text-sm mb-4 line-clamp-3">API protocol selection has a longer lifespan than almost any other technical decision. REST APIs from 2010 are still running in production. gRPC services chosen for internal communication in 2018 are tightly coupled to t‚Ä¶</p><div class="flex items-center justify-between text-xs text-gray-400"><span>Jun 18, 2025</span><span class="flex items-center gap-1"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>7 min read</span></div><div class="mt-3 flex flex-wrap gap-1"><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->grpc</span><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->rest</span><span class="text-xs text-gray-500 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">#<!-- -->graphql</span></div></article></a></div></div><div class="mt-12 text-center"><a class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium transition-colors" href="/blog/">‚Üê Back to all articles</a></div></div></div><footer class="bg-gray-900 text-white py-12"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8"><div class="col-span-1 md:col-span-1"><div><a class="text-xl font-bold block mb-3 text-white hover:text-blue-400 transition-colors" href="/">CodeSprintPro</a></div><p class="text-gray-400 text-sm mb-4 leading-relaxed">Deep-dive technical content on System Design, Java, Databases, AI/ML, and AWS ‚Äî by Sachin Sarawgi.</p><div class="flex space-x-4"><a href="https://github.com/codesprintpro" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white transition-colors" aria-label="Visit GitHub profile"><i class="fab fa-github text-xl"></i></a><a href="https://www.linkedin.com/in/sachin-sarawgi/" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white transition-colors" aria-label="Visit LinkedIn profile"><i class="fab fa-linkedin text-xl"></i></a><a href="https://medium.com/@codesprintpro" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white transition-colors" aria-label="Visit Medium profile"><i class="fab fa-medium text-xl"></i></a></div></div><div><h3 class="text-sm font-semibold uppercase tracking-widest text-gray-400 mb-4">Quick Links</h3><ul class="space-y-2"><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">Blog</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/#about">About</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/#portfolio">Portfolio</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/#contact">Contact</a></div></li></ul></div><div><h3 class="text-sm font-semibold uppercase tracking-widest text-gray-400 mb-4">Categories</h3><ul class="space-y-2"><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">System Design</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">Java</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">Databases</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">AI/ML</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">AWS</a></div></li><li><div><a class="text-gray-400 hover:text-white transition-colors text-sm" href="/blog/">Messaging</a></div></li></ul></div><div><h3 class="text-sm font-semibold uppercase tracking-widest text-gray-400 mb-4">Contact</h3><ul class="space-y-2 text-gray-400 text-sm"><li><a href="mailto:sachinsarawgi201143@gmail.com" class="hover:text-white transition-colors flex items-center gap-2"><i class="fas fa-envelope"></i> Email</a></li><li><a href="https://www.linkedin.com/in/sachin-sarawgi/" target="_blank" rel="noopener noreferrer" class="hover:text-white transition-colors flex items-center gap-2"><i class="fab fa-linkedin"></i> LinkedIn</a></li><li><a href="https://github.com/codesprintpro" target="_blank" rel="noopener noreferrer" class="hover:text-white transition-colors flex items-center gap-2"><i class="fab fa-github"></i> GitHub</a></li></ul></div></div><div class="border-t border-gray-800 pt-6 flex flex-col md:flex-row justify-between items-center gap-2"><p class="text-gray-500 text-sm">¬© <!-- -->2026<!-- --> CodeSprintPro ¬∑ Sachin Sarawgi. All rights reserved.</p><p class="text-gray-600 text-xs">Built with Next.js ¬∑ TailwindCSS ¬∑ Deployed on GitHub Pages</p></div></div></footer></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"System Design: Building a URL Shortener That Handles Billions of Requests","description":"A complete system design walkthrough for a URL shortener ‚Äî from requirements and storage estimates through hashing strategy, caching architecture, and global deployment patterns.","date":"2025-01-29","category":"System Design","tags":["system design","distributed systems","databases","caching","aws"],"featured":true,"affiliateSection":"system-design-courses","slug":"system-design-url-shortener","readingTime":"12 min read","excerpt":"The URL shortener is the \"Hello World\" of system design interviews ‚Äî but most candidates treat it superficially. The interesting parts are not in generating a short code; they're in the numbers that reveal the true scale‚Ä¶","contentHtml":"\u003cp\u003eThe URL shortener is the \"Hello World\" of system design interviews ‚Äî but most candidates treat it superficially. The interesting parts are not in generating a short code; they're in the numbers that reveal the true scale, the caching strategy that makes redirects feel instant, and the analytics pipeline that handles billions of click events without slowing down the redirect path.\u003c/p\u003e\n\u003cp\u003eLet's build bit.ly.\u003c/p\u003e\n\u003ch2\u003eRequirements\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eFunctional:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCreate a short URL from a long URL (with optional custom alias)\u003c/li\u003e\n\u003cli\u003eRedirect short URL to the original long URL\u003c/li\u003e\n\u003cli\u003eSet optional expiry on URLs\u003c/li\u003e\n\u003cli\u003eTrack click analytics (count, geo, referrer, device)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eNon-Functional:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e100M new URLs created per day\u003c/li\u003e\n\u003cli\u003e10:1 read-to-write ratio (1B redirects/day)\u003c/li\u003e\n\u003cli\u003eRedirect latency p99 \u0026#x3C; 50ms globally\u003c/li\u003e\n\u003cli\u003eHigh availability (99.99% uptime ‚Äî ~52 minutes downtime/year)\u003c/li\u003e\n\u003cli\u003eURL data retained for 5 years\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eBack-of-Envelope Calculations\u003c/h2\u003e\n\u003cp\u003eBefore writing any code, you need to understand the numbers. This calculation reveals the most important architectural constraint: the system is overwhelmingly read-heavy, which means caching is not an optimization ‚Äî it's the core design requirement.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eWrite throughput:\n  100M URLs/day √∑ 86,400 sec/day = ~1,160 writes/sec\n  Peak (10x): ~12,000 writes/sec\n\nRead throughput:\n  1B redirects/day = ~11,600 reads/sec\n  Peak: ~115,000 reads/sec\n\nStorage (5 years):\n  100M URLs/day √ó 365 days √ó 5 years = 182.5B URLs\n  Per URL record: 500 bytes (URL + metadata + indexes)\n  Total: 182.5B √ó 500 = ~91 TB\n\nCache:\n  Pareto principle: 20% of URLs generate 80% of traffic\n  Hot URLs to cache: 20% of daily URLs = 20M\n  Cache storage: 20M √ó 500 bytes = ~10 GB (fits on a single Redis node)\n\nShort code namespace:\n  Using Base62 (a-z, A-Z, 0-9) with 7 characters:\n  62^7 = 3.5 trillion unique codes (covers 182.5B URLs with room to spare)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNotice the asymmetry: reads outpace writes 100:1 at peak. This single insight drives nearly every architectural decision you'll make ‚Äî from separate read and write APIs to the three-tier caching strategy described later.\u003c/p\u003e\n\u003ch2\u003eAPI Design\u003c/h2\u003e\n\u003cp\u003eYour API surface should be minimal and purpose-driven. The three core endpoints map directly to the three user actions: create a short link, follow it, and measure its impact. Notice that the redirect uses a \u003ccode\u003e302\u003c/code\u003e status code rather than \u003ccode\u003e301\u003c/code\u003e ‚Äî a deliberate choice explained in the redirect implementation section.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ePOST /api/v1/urls\nBody: { \"longUrl\": \"https://...\", \"customAlias\": \"my-link\", \"expiresAt\": \"2026-01-01\" }\nResponse: { \"shortUrl\": \"https://codesprt.pro/ab3Xk2p\", \"shortCode\": \"ab3Xk2p\" }\n\nGET /{shortCode}\nResponse: 302 Redirect to long URL\nHeaders: Location: https://original-url.com\n\nDELETE /api/v1/urls/{shortCode}\nAuth: Bearer token (only URL owner can delete)\n\nGET /api/v1/urls/{shortCode}/analytics\nResponse: { \"totalClicks\": 15420, \"uniqueVisitors\": 8930, \"clicksByDay\": [...] }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eDatabase Schema\u003c/h2\u003e\n\u003cp\u003eYour database schema needs to serve two very different workloads: the URL lookup (read path) and click analytics (write-heavy, time-series). Keeping them in the same table ‚Äî or even the same database ‚Äî would let the analytics writes compete with redirect reads. The schema below separates these concerns explicitly.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003e-- URLs table (primary storage)\nCREATE TABLE urls (\n    id            BIGINT PRIMARY KEY,          -- Auto-increment or Snowflake ID\n    short_code    VARCHAR(10) UNIQUE NOT NULL, -- \"ab3Xk2p\"\n    long_url      TEXT NOT NULL,               -- Original URL (up to 2048 chars)\n    user_id       BIGINT,                      -- NULL for anonymous\n    created_at    TIMESTAMP NOT NULL DEFAULT NOW(),\n    expires_at    TIMESTAMP,                   -- NULL = never expires\n    is_active     BOOLEAN NOT NULL DEFAULT TRUE,\n    click_count   BIGINT NOT NULL DEFAULT 0    -- Approximate counter (for display)\n);\n\nCREATE INDEX idx_urls_short_code ON urls(short_code); -- Primary lookup index\nCREATE INDEX idx_urls_user_id ON urls(user_id);       -- User's URL history\nCREATE INDEX idx_urls_expires_at ON urls(expires_at) WHERE expires_at IS NOT NULL;\n\n-- Click events (analytics) ‚Äî separate table, separate DB\n-- Consider: ClickHouse or Cassandra for write-heavy analytics\nCREATE TABLE click_events (\n    id            UUID DEFAULT gen_random_uuid(),\n    short_code    VARCHAR(10) NOT NULL,\n    clicked_at    TIMESTAMP NOT NULL,\n    ip_hash       VARCHAR(64),                -- Hashed for privacy\n    country       VARCHAR(2),\n    city          VARCHAR(100),\n    device_type   VARCHAR(20),               -- mobile, desktop, tablet, bot\n    browser       VARCHAR(50),\n    referer       TEXT\n) PARTITION BY RANGE (clicked_at);           -- Monthly partitions\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe partial index on \u003ccode\u003eexpires_at WHERE expires_at IS NOT NULL\u003c/code\u003e is a subtle but important optimization: it only indexes rows that actually have an expiry, keeping the index small and fast for the cleanup job that runs nightly.\u003c/p\u003e\n\u003ch2\u003eShort Code Generation: Why Base62 Over MD5\u003c/h2\u003e\n\u003cp\u003eWith the schema established, the next question is how to generate the short code itself. This is where most candidates go straight to \"just MD5 the URL,\" but that approach has fundamental problems at scale. Here's a comparison of the real options and why each matters.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eOption A: MD5 hash of URL\u003c/strong\u003e ‚Äî Take first 7 characters of MD5(long_url)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eProblem: Two identical long URLs produce the same short code\u003c/li\u003e\n\u003cli\u003eProblem: Collision probability grows with scale (birthday problem)\u003c/li\u003e\n\u003cli\u003eProblem: Must check database for collision on every create ‚Äî expensive\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eOption B: Auto-increment ID encoded in Base62\u003c/strong\u003e ‚Äî Generate an auto-increment ID, encode to Base62\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eID 1 ‚Üí \"1\", ID 10,000 ‚Üí \"2bI\", ID 3,500,000,000 ‚Üí \"DTRK4\"\u003c/li\u003e\n\u003cli\u003eCollision-free by design ‚Äî each ID is unique\u003c/li\u003e\n\u003cli\u003eNo database read-before-write needed\u003c/li\u003e\n\u003cli\u003ePredictable (slightly guessable) ‚Äî acceptable for public short links\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eOption C: Snowflake ID\u003c/strong\u003e ‚Äî 64-bit unique ID with timestamp + worker ID + sequence\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGlobally unique across distributed systems without coordination\u003c/li\u003e\n\u003cli\u003eNot guessable (includes worker ID and microseconds)\u003c/li\u003e\n\u003cli\u003eEncodes to 7-8 Base62 characters\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eRecommended: Option B for simplicity, Option C for security.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe following implementation shows how a Base62 encoder works. Think of it like converting a decimal number to a different base ‚Äî the same way you convert binary to hexadecimal ‚Äî except here your \"digits\" are 62 characters from a-z, A-Z, and 0-9.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003epublic class Base62Encoder {\n\n    private static final String ALPHABET = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n\n    public static String encode(long id) {\n        if (id == 0) return String.valueOf(ALPHABET.charAt(0));\n        StringBuilder sb = new StringBuilder();\n        while (id \u003e 0) {\n            sb.append(ALPHABET.charAt((int)(id % 62)));\n            id /= 62;\n        }\n        return sb.reverse().toString();\n    }\n\n    public static long decode(String code) {\n        long id = 0;\n        for (char c : code.toCharArray()) {\n            id = id * 62 + ALPHABET.indexOf(c);\n        }\n        return id;\n    }\n}\n\n// Usage\nlong nextId = idGenerator.nextId(); // Redis INCR or DB sequence\nString shortCode = Base62Encoder.encode(nextId); // \"ab3Xk2p\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNotice that \u003ccode\u003edecode\u003c/code\u003e is the inverse operation: it lets you reconstruct the original database row ID from any short code, which is useful for debugging and for analytics joins.\u003c/p\u003e\n\u003ch2\u003eSystem Architecture\u003c/h2\u003e\n\u003cp\u003eWith your data model and encoding strategy in place, here is how all the components fit together. The key insight is that reads and writes are handled by entirely separate API services ‚Äî this lets you scale them independently and protects the high-throughput read path from any slowness in the write path.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                        ‚îÇ      CloudFront CDN       ‚îÇ\n                        ‚îÇ  (caches 301 redirects)   ‚îÇ\n                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                     ‚îÇ\n                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                        ‚îÇ    Application Load       ‚îÇ\n                        ‚îÇ    Balancer (ALB)         ‚îÇ\n                        ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò\n                           ‚îÇ                  ‚îÇ\n               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n               ‚îÇ  Write API   ‚îÇ          ‚îÇ   Read API       ‚îÇ\n               ‚îÇ  (URL create)‚îÇ          ‚îÇ   (redirects)    ‚îÇ\n               ‚îÇ  ~1.2K rps   ‚îÇ          ‚îÇ   ~115K rps      ‚îÇ\n               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                      ‚îÇ                       ‚îÇ\n         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n         ‚îÇ   PostgreSQL   ‚îÇ     ‚îÇ     Redis Cluster        ‚îÇ\n         ‚îÇ   Primary      ‚îÇ     ‚îÇ   (URL cache, ~10GB)     ‚îÇ\n         ‚îÇ   (writes)     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   Cache-hit rate: \u003e95%   ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                  ‚îÇ                         ‚îÇ cache miss\n         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n         ‚îÇ  PG Read        ‚îÇ      ‚îÇ   PostgreSQL Read     ‚îÇ\n         ‚îÇ  Replicas (2x)  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   Replicas           ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                           ‚îÇ\n                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                              ‚îÇ   Analytics Pipeline       ‚îÇ\n                              ‚îÇ  Kafka ‚Üí ClickHouse        ‚îÇ\n                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNotice how the analytics pipeline sits entirely off the critical read path. Click events are written asynchronously to Kafka, which means a slow analytics write can never delay a redirect response.\u003c/p\u003e\n\u003ch2\u003eThe Critical Path: Redirect in Under 50ms\u003c/h2\u003e\n\u003cp\u003eThe redirect is the most latency-sensitive operation in the system. Think of it like a highway toll booth: you need the transaction to complete in under a second, or traffic backs up. The implementation below achieves this by checking Redis first (1-2ms), falling back to the database only on a miss, and dispatching analytics entirely asynchronously so it never adds to your response time.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e@RestController\npublic class RedirectController {\n\n    @Autowired\n    private RedisTemplate\u0026#x3C;String, String\u003e redis;\n\n    @Autowired\n    private UrlRepository urlRepository;\n\n    @Autowired\n    private KafkaTemplate\u0026#x3C;String, ClickEvent\u003e kafkaTemplate;\n\n    @GetMapping(\"/{shortCode}\")\n    public ResponseEntity\u0026#x3C;Void\u003e redirect(\n            @PathVariable String shortCode,\n            HttpServletRequest request) {\n\n        String cacheKey = \"url:\" + shortCode;\n\n        // Step 1: Redis lookup (~1-2ms)\n        String longUrl = redis.opsForValue().get(cacheKey);\n\n        if (longUrl == null) {\n            // Step 2: Database lookup (cache miss, ~5-10ms)\n            Url url = urlRepository.findByShortCode(shortCode)\n                .filter(u -\u003e u.isActive())\n                .filter(u -\u003e u.getExpiresAt() == null || u.getExpiresAt().isAfter(Instant.now()))\n                .orElseThrow(() -\u003e new UrlNotFoundException(shortCode));\n\n            longUrl = url.getLongUrl();\n\n            // Populate cache (24h TTL, refresh on access)\n            redis.opsForValue().set(cacheKey, longUrl, Duration.ofHours(24));\n        }\n\n        // Step 3: Async analytics (never in critical path)\n        String finalUrl = longUrl;\n        CompletableFuture.runAsync(() -\u003e\n            kafkaTemplate.send(\"click-events\", ClickEvent.builder()\n                .shortCode(shortCode)\n                .timestamp(Instant.now())\n                .ipHash(hashIp(request.getRemoteAddr()))\n                .userAgent(request.getHeader(\"User-Agent\"))\n                .referer(request.getHeader(\"Referer\"))\n                .build())\n        );\n\n        // Step 4: Redirect (302 = don't cache, 301 = browser caches)\n        return ResponseEntity.status(HttpStatus.FOUND)\n            .header(HttpHeaders.LOCATION, finalUrl)\n            .build();\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003e302\u003c/code\u003e vs \u003ccode\u003e301\u003c/code\u003e choice is worth understanding deeply: a \u003ccode\u003e301\u003c/code\u003e tells browsers to cache the redirect permanently, reducing server load but making it impossible to update or expire the URL without clearing browser caches across all users. A \u003ccode\u003e302\u003c/code\u003e ensures every redirect hits your servers, which is why \u003ccode\u003e301\u003c/code\u003e is only appropriate for truly permanent, immutable links.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eTotal redirect time breakdown:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRedis hit: ~2ms\u003c/li\u003e\n\u003cli\u003eRedis miss + DB read: ~12ms\u003c/li\u003e\n\u003cli\u003eResponse serialization: ~1ms\u003c/li\u003e\n\u003cli\u003eNetwork: depends on region\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eCaching Strategy\u003c/h2\u003e\n\u003cp\u003eNow that you understand the critical path, the caching strategy becomes clear: you want to intercept requests as close to the user as possible, at each of three layers. Think of this like a library's book retrieval system ‚Äî you first check if the book is on your desk (Redis), then the local shelf (read replica), and only then send a request to the central archive (primary database).\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eThree-tier caching for redirects:\n\nTier 1: CDN (CloudFront)\n  - Cache 301 redirects at edge nodes (50+ global PoPs)\n  - TTL: match URL expiry, or 24h for non-expiring URLs\n  - Reduces latency to \u0026#x3C;10ms globally for hot URLs\n  - Invalidate via CloudFront API on URL deletion\n\nTier 2: Redis Cluster\n  - 10GB cluster covers top 20M URLs (80% of traffic)\n  - Eviction: allkeys-lfu (keeps frequently-accessed URLs)\n  - TTL: 24 hours, refreshed on access\n  - Replication: 1 primary + 2 replicas per shard\n\nTier 3: PostgreSQL Read Replicas\n  - 2 replicas with connection pooling (PgBouncer)\n  - Only for cache misses (\u0026#x3C;5% of traffic)\n  - Handles ~5,000 queries/sec comfortably\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe choice of \u003ccode\u003eallkeys-lfu\u003c/code\u003e (Least Frequently Used) eviction in Redis is deliberate: it keeps the URLs that receive the most ongoing traffic, rather than the most recently added ones (\u003ccode\u003eallkeys-lru\u003c/code\u003e). This ensures viral links stay in cache even if they were created weeks ago.\u003c/p\u003e\n\u003ch2\u003eAnalytics: ClickHouse for Sub-Second Queries on Billions of Rows\u003c/h2\u003e\n\u003cp\u003ePostgreSQL cannot efficiently aggregate billions of click events. ClickHouse, a column-oriented OLAP database, handles this natively. The distinction matters because PostgreSQL stores data row-by-row (great for fetching complete records), while ClickHouse stores data column-by-column (great for aggregating one column across billions of rows). When you run \u003ccode\u003eCOUNT(*)\u003c/code\u003e on a 90-day click log, ClickHouse only reads the \u003ccode\u003eclicked_at\u003c/code\u003e column ‚Äî not the entire row ‚Äî which is why it stays fast at scale.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003e-- ClickHouse schema\nCREATE TABLE click_events (\n    short_code    LowCardinality(String),   -- dictionary-encoded for efficiency\n    clicked_at    DateTime,\n    country       LowCardinality(String),\n    device_type   LowCardinality(String),\n    browser       LowCardinality(String),\n    ip_hash       FixedString(32)\n) ENGINE = MergeTree()\nPARTITION BY toYYYYMM(clicked_at)\nORDER BY (short_code, clicked_at);\n\n-- Analytics query: 30-day click trend ‚Äî runs in \u0026#x3C;1 second on billions of rows\nSELECT\n    toDate(clicked_at) AS date,\n    count() AS total_clicks,\n    uniqExact(ip_hash) AS unique_visitors,\n    countIf(device_type = 'mobile') AS mobile_clicks\nFROM click_events\nWHERE short_code = 'ab3Xk2p'\n  AND clicked_at \u003e= now() - INTERVAL 30 DAY\nGROUP BY date\nORDER BY date;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003eLowCardinality(String)\u003c/code\u003e type is a ClickHouse optimization worth noting: for columns with a small number of distinct values (like \u003ccode\u003edevice_type\u003c/code\u003e or \u003ccode\u003ecountry\u003c/code\u003e), ClickHouse applies dictionary encoding automatically, reducing storage by up to 10x and accelerating GROUP BY operations significantly.\u003c/p\u003e\n\u003ch2\u003eEdge Cases That Matter in Interviews\u003c/h2\u003e\n\u003cp\u003eWith the happy path designed, you need to handle the failure modes. These edge cases are not hypothetical ‚Äî each represents a real abuse vector or operational issue that production URL shorteners encounter daily.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1. Custom alias collision:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWhen a user requests a custom alias, you must check for uniqueness before committing, because unlike auto-generated codes, custom aliases can conflict with existing entries.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003eif (customAlias != null) {\n    if (urlRepository.existsByShortCode(customAlias)) {\n        throw new AliasAlreadyTakenException(customAlias);\n    }\n    shortCode = customAlias;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e2. URL validation:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWithout validation, your shortener becomes a free proxy for phishing and malware distribution. Checking that the target URL is not your own domain prevents redirect loops, while the safety check guards against abuse.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// Prevent redirect loops and abuse\nprivate void validateUrl(String longUrl) {\n    if (longUrl.contains(\"codesprt.pro\")) {\n        throw new InvalidUrlException(\"Cannot shorten our own URLs\");\n    }\n    // Check against malware/phishing blocklist\n    if (safetyCheckService.isMalicious(longUrl)) {\n        throw new MaliciousUrlException();\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e3. Expired URL cleanup:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eExpired URLs should never be hard-deleted, because the analytics records still reference them. A nightly soft-delete sets \u003ccode\u003eis_active = false\u003c/code\u003e so the redirect path rejects the code while the analytics data remains intact.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e@Scheduled(cron = \"0 0 2 * * *\") // 2 AM daily\npublic void deactivateExpiredUrls() {\n    urlRepository.deactivateExpired(Instant.now()); // Soft delete\n    // Don't hard delete ‚Äî analytics need the record\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e4. Rate limiting URL creation:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-java\"\u003e// 100 URLs/day for free tier, 10,000/day for pro\n// Redis sliding window: see rate limiter article\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe URL shortener is a microcosm of distributed systems challenges: write idempotency, cache invalidation, async event processing, and global latency targets. Nail these, and you've demonstrated the architectural thinking that matters.\u003c/p\u003e\n","tableOfContents":[{"id":"requirements","text":"Requirements","level":2},{"id":"back-of-envelope-calculations","text":"Back-of-Envelope Calculations","level":2},{"id":"api-design","text":"API Design","level":2},{"id":"database-schema","text":"Database Schema","level":2},{"id":"short-code-generation-why-base62-over-md5","text":"Short Code Generation: Why Base62 Over MD5","level":2},{"id":"system-architecture","text":"System Architecture","level":2},{"id":"the-critical-path-redirect-in-under-50ms","text":"The Critical Path: Redirect in Under 50ms","level":2},{"id":"caching-strategy","text":"Caching Strategy","level":2},{"id":"analytics-clickhouse-for-sub-second-queries-on-billions-of-rows","text":"Analytics: ClickHouse for Sub-Second Queries on Billions of Rows","level":2},{"id":"edge-cases-that-matter-in-interviews","text":"Edge Cases That Matter in Interviews","level":2}]},"relatedPosts":[{"title":"Building Production Observability with OpenTelemetry and Grafana Stack","description":"End-to-end observability implementation: distributed tracing with OpenTelemetry, metrics with Prometheus, structured logging with Loki, and the dashboards and alerts that actually help during incidents.","date":"2025-07-03","category":"System Design","tags":["observability","opentelemetry","prometheus","grafana","loki","tracing","spring boot","monitoring"],"featured":false,"affiliateSection":"system-design-courses","slug":"observability-opentelemetry-production","readingTime":"6 min read","excerpt":"Observability is not the same as monitoring. Monitoring tells you something is wrong. Observability lets you understand why ‚Äî by exploring system state through metrics, traces, and logs without needing to know in advance‚Ä¶"},{"title":"Event Sourcing and CQRS in Production: Beyond the Theory","description":"What event sourcing actually looks like in production Java systems: event store design, snapshot strategies, projection rebuilding, CQRS read model synchronization, and the operational challenges nobody talks about.","date":"2025-06-23","category":"System Design","tags":["event sourcing","cqrs","system design","java","distributed systems","kafka","spring boot"],"featured":false,"affiliateSection":"distributed-systems-books","slug":"event-sourcing-cqrs-production","readingTime":"7 min read","excerpt":"Event sourcing is one of those patterns that looks elegant in conference talks and becomes surprisingly complex in production systems. The theory ‚Äî store events instead of state, derive state by replaying events ‚Äî is sou‚Ä¶"},{"title":"gRPC vs REST vs GraphQL: Choosing the Right API Protocol","description":"A technical comparison of REST, gRPC, and GraphQL across performance, developer experience, schema evolution, streaming, and real production use cases. When each protocol wins and where each falls short.","date":"2025-06-18","category":"System Design","tags":["grpc","rest","graphql","api design","system design","microservices","protocol buffers"],"featured":false,"affiliateSection":"system-design-courses","slug":"grpc-vs-rest-vs-graphql","readingTime":"7 min read","excerpt":"API protocol selection has a longer lifespan than almost any other technical decision. REST APIs from 2010 are still running in production. gRPC services chosen for internal communication in 2018 are tightly coupled to t‚Ä¶"}]},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"system-design-url-shortener"},"buildId":"rpFn_jslWZ9qPkJwor7RD","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>